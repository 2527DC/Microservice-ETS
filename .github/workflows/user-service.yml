# name: "Deployment Workflow for User Service"

# on:
#   push:
#     branches:
#       - dev
#       - testing
#       - main
#     paths:
#       - "packages/service-user/**"

# jobs:
#   build-and-push-to-Docker-Hub:
#     name: "Build the Docker image and push to Docker Hub"
#     runs-on: ubuntu-latest

#     steps:
#       - name: "Checkout Repository"
#         uses: actions/checkout@v4

#       # ‚úÖ Correct action name (was 'setip', should be 'setup')
#       - name: "Setting up the Docker build environment"
#         uses: docker/setup-buildx-action@v3

#       - name: "Login to Docker Hub"
#         uses: docker/login-action@v3
#         with:
#           username: ${{ secrets.DOCKER_HUB_USERNAME }}
#           password: ${{ secrets.DOCKER_HUB_ACCESS_TOKEN }}

#       - name: "Determine Environment Tag"
#         id: vars
#         run: |
#           echo "GITHUB_REF_NAME=${GITHUB_REF_NAME}"
#           if [[ "${GITHUB_REF_NAME}" == "dev" ]]; then
#             echo "ENV_TAG=dev" >> $GITHUB_ENV
#             echo "BUILD_TARGET=development" >> $GITHUB_ENV
#           elif [[ "${GITHUB_REF_NAME}" == "testing" ]]; then
#             echo "ENV_TAG=testing" >> $GITHUB_ENV
#             echo "BUILD_TARGET=development" >> $GITHUB_ENV
#           else
#             echo "ENV_TAG=latest" >> $GITHUB_ENV
#             echo "BUILD_TARGET=production" >> $GITHUB_ENV
#           fi
#           echo "ENV_TAG=${ENV_TAG}"
#           echo "BUILD_TARGET=${BUILD_TARGET}"

#       # üß† This step logs & validates the Dockerfile path before the build
#       - name: "Verify Dockerfile Path"
#         run: |
#           echo "üîç Current directory:"
#           pwd
#           echo "üìÅ Listing all files under ./packages/service-user:"
#           ls -R ./packages/service-user || echo "‚ö†Ô∏è Directory not found!"
#           echo "‚úÖ Checking Dockerfile exists:"
#           if [ -f ./packages/service-user/Dockerfile ]; then
#             echo "‚úÖ Dockerfile found at ./packages/service-user/Dockerfile"
#           else
#             echo "‚ùå Dockerfile not found!"
#             exit 1
#           fi

#       - name: "Build and Push Docker Image"
#         uses: docker/build-push-action@v6
#         with:
#           context: ./packages/service-user
#           file: ./packages/service-user/Dockerfile
#           push: true
#           target: ${{ env.BUILD_TARGET }}
#           tags: ${{ secrets.DOCKER_HUB_USERNAME }}/microservice:user-${{ env.ENV_TAG }}
